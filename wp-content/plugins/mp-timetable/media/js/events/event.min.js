Registry.register("Event",function(t){"use strict";var e;return{getInstance:function(){return e||(e={event_id:"",eventsData:{},init:function(){e.initTimePicker(),e.addEventButton(),e.initDeleteButtons(),e.initEditButtons(),e.initColorPicker(),e.initDatePicker(),e.columnRadioBox()},initTimePicker:function(){var e=Boolean(parseInt(t("#time_format").val()));t("#event_start").timepicker({showPeriod:e,showPeriodLabels:e,defaultTime:"00:00"}),t("#event_end").timepicker({showPeriod:e,showPeriodLabels:e,defaultTime:"00:00"})},initSlider:function(n,a){var i=!_.isUndefined(a)&&Boolean(a),s=n.replace(/^\D+/g,"");t(n).carouFredSel({items:{visible:3},direction:"up",scroll:{items:1,easing:"swing",pauseOnHover:!0,onAfter:function(e){e.items.old.each(function(){t(this).removeClass("visible")}),e.items.visible.each(function(){t(this).addClass("visible")})}},auto:{play:i,timeoutDuration:3e3},prev:{button:"#mp_prev_button"+s},next:{button:"#mp_next_button"+s}}),t(n).trigger("currentVisible",function(t){t.addClass("visible")}),e.setColorSettings(n+" .mptt-colorized")},initDeleteButton:function(){var e=t("#events-list");e.find("li.event").find("i.operation-button.dashicons-no.dashicons").off("click").on("click",function(){e.find("li.event").length>1?t(this).parents("li.event").remove():e.remove()})},initColorPicker:function(e){_.isUndefined(e)&&(e="");var n=t(e+" input.clr-picker"),a=t(e+" input.regular-text");n.spectrum("destroy"),n.spectrum({preferredFormat:"rgb",showInput:!0,showAlpha:!0,allowEmpty:!0,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],showPalette:!0,show:function(e){t(this).val(e)},hide:function(e){t(this).parents(".select-color").find(".regular-text").val(t(this).val())},change:function(e){t(this).parents(".select-color").find('input:not([type="hidden"])').val(t(this).val())}}),a.off("keyup").on("keyup",function(){var e=t(this).parents(".select-color"),n=e.find(".clr-picker"),a=e.find(".regular-text").val();e.find(".sp-preview-inner").css({"background-color":a}),n.spectrum("set",a)})},addEventButton:function(){t(document).on("click.admin","#add_mp_event",function(){t(this).hasClass("edit")?e.updateEventData():e.renderEventItem()})},initDeleteButtons:function(){t(document).on("click.admin","#events-list .delete-event-button",function(){var n=t(this).attr("data-id");e.deleteEvent(n)})},initEditButtons:function(){t(document).on("click.admin","#events-list .edit-event-button",function(){var n=t(this).attr("data-id"),a=t(this).parent().parent();t(this).parent().find(".spinner").addClass("is-active"),Registry._get("adminFunctions").wpAjax({controller:"events",action:"get_event_data",id:n},function(n){var i=t("#add_mp_event"),s=t("#events-list");s.find(".spinner").removeClass("is-active"),s.find(" tr").removeClass("active"),a.addClass("active"),t("#event_start").val(n.event_start),t("#event_end").val(n.event_end),t("#description").val(n.description),t("#user_id").val(n.user_id),t("#weekday_id").val(n.column_id),i.addClass("edit"),i.val("Update"),e.event_id=n.id},function(t){console.warn(t)})})},deleteEvent:function(e){Registry._get("adminFunctions").wpAjax({controller:"events",action:"delete",id:e},function(n){var a=t("#events-list").find('tr[data-id="'+e+'"]');a.length&&a.remove()},function(t){console.log(t)})},updateEventItem:function(){var n=t("#events-list").find('tr[data-id="'+e.event_id+'"]'),a=t("#user_id");n.find("td.event-column").text(t("#weekday_id").find("option:selected").text()),n.find("td.event-start").text(t("#event_start").val()),n.find("td.event-end").text(t("#event_end").val()),n.find("td.event-user-id").text("-1"===a.val()?"":a.find("option:selected").text()),n.find("td.event-description").text(t("#description").val()),e.event_id=null,t("#add_mp_event").removeClass("edit").val("Add New")},updateEventData:function(){var n=t("#add_event_table").find(".spinner");n.addClass("is-active"),Registry._get("adminFunctions").wpAjax({controller:"events",action:"update_event_data",data:{id:Registry._get("Event").event_id,event_start:t("#event_start").val(),event_end:t("#event_end").val(),description:t("#description").val(),user_id:t("#user_id").val(),weekday_ids:t("#weekday_id").val()}},function(){n.removeClass("is-active"),e.updateEventItem(),e.clearTable()},function(t){n.removeClass("is-active"),console.log(t)})},renderEventItem:function(){var n=t("#weekday_id"),a=t("#user_id"),i=n.find("option:selected").val(),s=t("#event_start"),d=t("#event_end"),o=t("#description"),r={tag:"tr",attrs:{},content:[{tag:"td",attrs:{style:"display:none;"},content:[{tag:"input",attrs:{type:"hidden",name:"event_data["+i+"][weekday_ids][]",value:i}},{tag:"input",attrs:{type:"hidden",name:"event_data["+i+"][event_start][]",value:s.val()}},{tag:"input",attrs:{type:"hidden",name:"event_data["+i+"][event_end][]",value:d.val()}},{tag:"input",attrs:{type:"hidden",name:"event_data["+i+"][description][]",value:o.val()}},{tag:"input",attrs:{type:"hidden",name:"event_data["+i+"][user_id][]",value:a.val()}}]},{tag:"td",attrs:{class:"event-column"},content:[n.find("option:selected").text()]},{tag:"td",attrs:{class:"event-start"},content:[s.val()]},{tag:"td",attrs:{class:"event-end"},content:[d.val()]},{tag:"td",attrs:{class:"event-description"},content:[o.val()]},{tag:"td",attrs:{class:"event-user-id"},content:["-1"===a.val()?"":a.find("option:selected").text()]},{tag:"td",attrs:{},content:[]}]},c=Registry._get("adminFunctions").getHtml(r);t("#events-list").find("tbody").append(c),t(".events-list-wrapper").scrollTop(1e10),e.clearTable()},setEventHeight:function(e){var n=e.parent().outerHeight(),a=t("body"),i=e.height(),s=e.data("min-height"),d=e.find(".mptt-inner-event-content").height();e.css("position","").css("width","").css("min-height",""),a.hasClass("mprm_ie_browser")?(d=e.css("height","").find(".mptt-inner-event-content").height(),e.height(i),d<=s?e.css("max-height",s):(e.css("height",""),e.css("max-height",d))):d<=s?e.css("min-height",s):e.css("min-height",d),n<i&&e.height(i)},recalculate_Height:function(e,n){var a=t(".mptt-event-container",e),i=a.length,s=0,d=0,o=e.height();t("body").hasClass("mprm_ie_browser")?(s=o/(i>0?i:1),_.isUndefined(n)?t.each(a,function(){var e=t(this);if(e.height(s),_.isEmpty(e.data("min-height"))){var n=e.height();0===n?e.data("min-height",s):e.data("min-height",n)}e.css("top",d+"px"),e.removeClass("mptt-hidden"),d+=s}):n.height(s)):(s=100/(i>0?i:1),_.isUndefined(n)?t.each(a,function(){var e=t(this);e.height(s+"%"),_.isEmpty(e.data("min-height"))&&e.data("min-height",e.height()),e.css("top",d+"%"),e.removeClass("mptt-hidden"),d+=s}):n.height(s+"%"))},setEventsHeight:function(){var n=t(".mptt-shortcode-wrapper").find("table").find("td.event");t.each(n,function(){var n=t(this);e.recalculate_Height(n)})},setColorSettings:function(n){_.isUndefined(n)&&(n=".mptt-colorized");var a=t(n);t.each(a,function(){var n=t(this),a=n.attr("data-bg_hover_color"),i=n.attr("data-hover_color"),s=n.parent();switch(n.attr("data-type")){case"column":case"event":n.hover(function(){_.isEmpty(a)||n.css("background-color",a),_.isEmpty(i)||n.css("color",i),e.setEventHeight(n)},function(){n.css("max-height","").css("min-height",""),e.recalculate_Height(s,n),n.css("background-color",n.attr("data-bg_color")),n.css("color",n.attr("data-color"))});break;case"widget":n.hover(function(){n.css("background-color",n.attr("data-background-hover-color")),n.css("color",t(this).attr("data-hover-color")),n.css("border-left-color",n.attr("data-hover-border-color"))},function(){n.css("background-color",n.attr("data-background-color")),n.css("color",n.attr("data-color")),n.css("border-left-color",n.attr("data-border-color"))})}})},clearTable:function(){var e=t("#weekday_id");t("#add_event_table input:not(.button),#add_event_table textarea").val(""),e.val(e.find("option:first").attr("value"))},getRowSpan:function(e){var n=[],a=[];t.each(e,function(e){var i=t(this).attr("data-start"),s=t(this).attr("data-end");a[e]=i,n[e]=s});var i=Math.min.apply(Math,a),s=Math.max.apply(Math,n)-i;return s<1?1:s},responsiveFilter:function(e){var n="all",a=e.parents(".mptt-shortcode-wrapper");n=e.is("select")?e.val():e.attr("href").replace("#","");var i=a.find(".mptt-list-event");"all"!==n?(i.hide(),a.find('.mptt-list-event[data-event-id="'+n+'"]').show()):i.show(),t.each(a.find(".mptt-column"),function(){t(this).show(),t(this).find(".mptt-list-event:visible").length<1&&t(this).hide()})},filterStatic:function(t,n){var a=t.parents(".mptt-shortcode-wrapper"),i="#all",s=_.isEmpty(a.attr("id"))?"not-set":a.attr("id");i=t.is("select")?t.val():t.attr("href").replace("#",""),0==n||void 0===n.originalEvent||(window.location.hash=s+":"+i),a.find("table").hide(),a.find('table[id="#'+i+'"]').fadeIn(),e.setEventsHeight()},setClassTd:function(){t.each(t(".mptt-event-container"),function(){t(this).parents("td").addClass("event")})},initTableData:function(){e.setClassTd(),e.setRowSpanTd();var n="."+MPTT.table_class;t(n).data("hide_empty_row")&&e.hideEmptyRows()},filterShortcodeEvents:function(){var n=t(".mptt-menu");n.length&&(n.off("change").on("change",function(n){e.filterStatic(t(this),n),e.responsiveFilter(t(this))}),t(".mptt-navigation-tabs.mptt-menu a").off("click").on("click",function(n){var a=t(this);a.parents(".mptt-navigation-tabs.mptt-menu").find("li").removeClass("active"),a.parents("li").addClass("active"),e.filterStatic(a,n),e.responsiveFilter(a)}))},showCurrentEvent:function(t,e){t.find(".mptt-menu").hasClass("mptt-navigation-tabs")?t.find(".mptt-navigation-tabs").find('a[href="#'+e+'"]').click():t.find(".mptt-menu").hasClass("mptt-navigation-select")&&t.find('.mptt-navigation-select option[value="'+e+'"]')?t.find(".mptt-navigation-select").val(e).change():t.find('table[id="#all"]').fadeIn()},getFilterByHash:function(){var n=window.location.hash;if(!_.isUndefined(n)){var a=n.split(":"),i=a[0],s=a[1],d=t(".mptt-shortcode-wrapper");s=_.isUndefined(s)?"all":s,1===d.length?e.showCurrentEvent(d,s):t.each(d,function(n,a){var d=t(a);"#"+d.attr("id")===i?e.showCurrentEvent(d,s):e.showCurrentEvent(d,"all")})}e.setEventsHeight()},removeCellsAfterChangeColSpan:function(t,e,n,a){for(;t<e;t++){var i=n.find('th[data-index="'+t+'"]').data("column-id");a.find('td:not(.event)[data-column-id="'+i+'"]').remove()}},removeCellsAfterChangeRowSpan:function(t,n,a,i){for(var s=t.parents("tr").attr("data-index"),d=n+parseInt(s)-1,o=t.attr("colspan"),r=a.find('th[data-column-id="'+i+'"]').data("index"),c=parseInt(r)+parseInt(o);s<d;s++){var l=a.find("tr.mptt-shortcode-row-"+(parseInt(s)+1));if(l.length){if(l.find('td.event[data-column-id="'+i+'"]').length&&(n-=d-s)<2){n=1;break}o>1&&e.removeCellsAfterChangeColSpan(r,c,a,l),l.find('td:not(.event)[data-column-id="'+i+'"]').remove()}}return n},setRowSpanTd:function(){var n="."+MPTT.table_class;t.each(t(n),function(){var n=t(this);t.each(n.find("td.event"),function(){var a=t(this),i=a.find(".mptt-event-container"),s=a.attr("data-column-id"),d=a.attr("data-row_height"),o=e.getRowSpan(i);!_.isUndefined(o)&&o>1&&(o=e.removeCellsAfterChangeRowSpan(a,o,n,s),isNaN(d)||a.css("height",o*d)),a.attr("rowspan",o)})})},hideEmptyRows:function(){var e="."+MPTT.table_class,n=t(e+" tbody tr"),a=t(e).first().find("th").length;t.each(n,function(e,n){0===t(n).find("td.event").length&&t(n).find("td").length===a&&t(n).remove()})},displaySettings:function(){var e=t(".view_settings");e.length&&e.change(function(){"all"===t(this).val()?(t(this).attr("id"),t(this).parents(".mptt-container").find(".next-days").css("display","block")):t(this).parents(".mptt-container").find(".next-days").css("display","none")})},timeMode:function(e){if(e){var n="."+t(this).attr("id");t("#"+e).change(function(){"server"===t(this).val()?(t(this).attr("id"),t(this).parents(".mptt-container").find(n).css("display","block")):t(this).parents(".mptt-container").find(n).css("display","none")})}},initDatePicker:function(){var e=t("#datepicker");e.length&&e.datepicker({dateFormat:"d/m/yy",setDate:Date.parse(e.val())})},columnRadioBox:function(){var e=t("#datepicker"),n=t('input.option-input[name="column[column_option]"]'),a=t("select.mp-weekday");n.length&&n.on("change",function(){switch(t(this).val()){case"simple":a.prop("disabled",!0),e.prop("disabled",!0);break;case"weekday":a.prop("disabled",!1),e.val("").prop("disabled",!0);break;case"date":a.prop("disabled",!0),e.prop("disabled",!1)}})}}),e}}}(jQuery));